{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Porhc/OneDrive/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/oil/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Porhc/OneDrive/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/oil/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from'axios';// import { trusted } from 'mongoose';\nimport jwtDecode from'jwt-decode';axios.defaults.baseURL=process.env.REACT_APP_SERVER_DOMAIN;//make API Requests\n// получение ниka из токена\nexport function getUsername(){return _getUsername.apply(this,arguments);}//authenticat function\nfunction _getUsername(){_getUsername=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var token,decode;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=localStorage.getItem('token');if(token){_context.next=3;break;}return _context.abrupt(\"return\",Promise.reject(\"Не получается найти токен\"));case 3:decode=jwtDecode(token);// console.log(decode);\nreturn _context.abrupt(\"return\",decode);case 5:case\"end\":return _context.stop();}}},_callee);}));return _getUsername.apply(this,arguments);}export function authenticate(_x){return _authenticate.apply(this,arguments);}//get User details\nfunction _authenticate(){_authenticate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(username){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post('/api/authenticate',{username:username});case 3:return _context2.abrupt(\"return\",_context2.sent);case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",{error:\"Имя пользователя не существует\"});case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return _authenticate.apply(this,arguments);}export function getUser(_x2){return _getUser.apply(this,arguments);}// register user function \nfunction _getUser(){_getUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(_ref){var username,_yield$axios$get,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:username=_ref.username;_context3.prev=1;_context3.next=4;return axios.get(\"/api/user/\".concat(username));case 4:_yield$axios$get=_context3.sent;data=_yield$axios$get.data;return _context3.abrupt(\"return\",{data:data});case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);return _context3.abrupt(\"return\",{error:\"Пароли не совпадают\"});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return _getUser.apply(this,arguments);}export function registerUser(_x3){return _registerUser.apply(this,arguments);}// login function\nfunction _registerUser(){_registerUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(credentials){var _yield$axios$post,msg,status,username,email;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return axios.post(\"/api/register\",credentials);case 3:_yield$axios$post=_context4.sent;msg=_yield$axios$post.data.msg;status=_yield$axios$post.status;username=credentials.username,email=credentials.email;// send mail\nif(!(status===201)){_context4.next=10;break;}_context4.next=10;return axios.post('/api/registerMail',{username:username,userEmail:email,text:msg});case 10:return _context4.abrupt(\"return\",Promise.resolve(msg));case 13:_context4.prev=13;_context4.t0=_context4[\"catch\"](0);return _context4.abrupt(\"return\",Promise.reject({error:_context4.t0}));case 16:case\"end\":return _context4.stop();}}},_callee4,null,[[0,13]]);}));return _registerUser.apply(this,arguments);}export function verifyPassword(_x4){return _verifyPassword.apply(this,arguments);}// uptade user profile function\nfunction _verifyPassword(){_verifyPassword=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(_ref2){var username,password,_yield$axios$post2,data;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:username=_ref2.username,password=_ref2.password;_context5.prev=1;if(!username){_context5.next=8;break;}_context5.next=5;return axios.post('/api/login',{username:username,password:password});case 5:_yield$axios$post2=_context5.sent;data=_yield$axios$post2.data;return _context5.abrupt(\"return\",Promise.resolve({data:data}));case 8:_context5.next=13;break;case 10:_context5.prev=10;_context5.t0=_context5[\"catch\"](1);return _context5.abrupt(\"return\",Promise.reject({error:\"Пароли не совпадают\"}));case 13:case\"end\":return _context5.stop();}}},_callee5,null,[[1,10]]);}));return _verifyPassword.apply(this,arguments);}export function updateUser(_x5){return _updateUser.apply(this,arguments);}// generate OTP\nfunction _updateUser(){_updateUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(response){var token,data;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return localStorage.getItem('token');case 3:token=_context6.sent;_context6.next=6;return axios.put('/api/updateuser',response,{headers:{\"Authorization\":\"Bearer \".concat(token)}});case 6:data=_context6.sent;return _context6.abrupt(\"return\",Promise.resolve({data:data}));case 10:_context6.prev=10;_context6.t0=_context6[\"catch\"](0);return _context6.abrupt(\"return\",Promise.reject({error:\"Не возможно обновить профиль\"}));case 13:case\"end\":return _context6.stop();}}},_callee6,null,[[0,10]]);}));return _updateUser.apply(this,arguments);}export function generateOTP(_x6){return _generateOTP.apply(this,arguments);}// verify OTP\nfunction _generateOTP(){_generateOTP=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(username){var _yield$axios$get2,code,status,_yield$getUser,email,text;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return axios.get('/api/generateOTP',{params:{username:username}});case 3:_yield$axios$get2=_context7.sent;code=_yield$axios$get2.data.code;status=_yield$axios$get2.status;if(!(status===201)){_context7.next=14;break;}_context7.next=9;return getUser({username:username});case 9:_yield$getUser=_context7.sent;email=_yield$getUser.data.email;text=\"\\u0412\\u0430\\u0448 \\u043A\\u043E\\u0434 \\u0432\\u043E\\u0441\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u044F \\u043F\\u0430\\u0440\\u043E\\u043B\\u044F: \".concat(code,\". \\u0412\\u043E\\u0441\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u0438\\u0442\\u0435 \\u0441\\u043E\\u0432\\u043E\\u0439 \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C.\");_context7.next=14;return axios.post('/api/registerMail',{username:username,userEmail:email,text:text,subject:\"Код восстановления пароля\"});case 14:return _context7.abrupt(\"return\",Promise.resolve(code));case 17:_context7.prev=17;_context7.t0=_context7[\"catch\"](0);console.error(\"ошибка создания кода\",_context7.t0);return _context7.abrupt(\"return\",Promise.reject({error:_context7.t0.message||\"Произошла ошибка при генерации OTP\"}));case 21:case\"end\":return _context7.stop();}}},_callee7,null,[[0,17]]);}));return _generateOTP.apply(this,arguments);}export function verifyOTP(_x7){return _verifyOTP.apply(this,arguments);}// reset password\nfunction _verifyOTP(){_verifyOTP=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(_ref3){var username,code,_yield$axios$get3,data,status;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:username=_ref3.username,code=_ref3.code;_context8.prev=1;console.log(\"Sending request to verify OTP with:\",{username:username,code:code});_context8.next=5;return axios.get('/api/verifyOTP',{params:{username:username,code:code}});case 5:_yield$axios$get3=_context8.sent;data=_yield$axios$get3.data;status=_yield$axios$get3.status;return _context8.abrupt(\"return\",{data:data,status:status});case 11:_context8.prev=11;_context8.t0=_context8[\"catch\"](1);console.error(\"Error verifying OTP:\",_context8.t0);return _context8.abrupt(\"return\",Promise.reject(_context8.t0));case 15:case\"end\":return _context8.stop();}}},_callee8,null,[[1,11]]);}));return _verifyOTP.apply(this,arguments);}export function resetPassword(_x8){return _resetPassword.apply(this,arguments);}function _resetPassword(){_resetPassword=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(_ref4){var username,password,_yield$axios$put,data,status;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:username=_ref4.username,password=_ref4.password;_context9.prev=1;_context9.next=4;return axios.put('/api/resetPassword',{username:username,password:password});case 4:_yield$axios$put=_context9.sent;data=_yield$axios$put.data;status=_yield$axios$put.status;return _context9.abrupt(\"return\",Promise.resolve({data:data,status:status}));case 10:_context9.prev=10;_context9.t0=_context9[\"catch\"](1);return _context9.abrupt(\"return\",Promise.reject({error:_context9.t0}));case 13:case\"end\":return _context9.stop();}}},_callee9,null,[[1,10]]);}));return _resetPassword.apply(this,arguments);}","map":{"version":3,"names":["axios","jwtDecode","defaults","baseURL","process","env","REACT_APP_SERVER_DOMAIN","getUsername","token","localStorage","getItem","Promise","reject","decode","authenticate","username","post","error","getUser","get","data","registerUser","credentials","msg","status","email","userEmail","text","resolve","verifyPassword","password","updateUser","response","put","headers","generateOTP","params","code","subject","console","message","verifyOTP","log","resetPassword"],"sources":["C:/Users/Porhc/OneDrive/Рабочий стол/oil/client/src/helper/helper.js"],"sourcesContent":["import axios from 'axios';\n// import { trusted } from 'mongoose';\nimport jwtDecode from 'jwt-decode';\n\naxios.defaults.baseURL = process.env.REACT_APP_SERVER_DOMAIN;\n\n\n//make API Requests\n\n\n// получение ниka из токена\nexport async function getUsername() {\n    const token = localStorage.getItem('token')\n    if(!token) return Promise.reject(\"Не получается найти токен\");\n    let decode = jwtDecode (token)\n    // console.log(decode);\n    return decode\n}\n\n//authenticat function\nexport async function authenticate(username){\n    try{\n        return await axios.post('/api/authenticate', { username });\n    }catch (error) {\n        return {\n            error : \"Имя пользователя не существует\"\n        }\n    }\n}\n\n//get User details\nexport async function getUser({username}){\n    try {\n        const { data } = await axios.get(`/api/user/${username}`);\n        return{ data };\n    }catch(error) {\n        return{ error : \"Пароли не совпадают\"}\n    }\n}\n\n// register user function \nexport async function registerUser(credentials){\n    try {\n        const { data: { msg }, status } = await axios.post(`/api/register`, credentials);\n\n        let { username, email } = credentials;\n\n        // send mail\n        if(status === 201){\n            await axios.post('/api/registerMail', {username, userEmail : email, text : msg})\n        }\n\n        return Promise.resolve(msg)\n    } catch (error) {\n        return Promise.reject({ error })\n    }\n}\n\n// login function\nexport async function verifyPassword({ username, password}){\n    try {\n        if(username){\n           const { data } = await axios.post('/api/login', { username, password });\n           return Promise.resolve({ data })\n        }\n    } catch (error) {\n        return Promise.reject({error : \"Пароли не совпадают\"})\n    }\n}\n\n// uptade user profile function\nexport async function updateUser(response){\n    try {\n        const token = await localStorage.getItem('token');\n        const data = await axios.put('/api/updateuser', response, { headers : { \"Authorization\" : `Bearer ${token}`}});\n\n        return Promise.resolve({ data })\n    } catch (error) {\n        return Promise.reject({ error : \"Не возможно обновить профиль\"})\n    }\n}\n\n// generate OTP\nexport async function generateOTP(username){\n    try {\n        const { data : { code }, status } = await axios.get('/api/generateOTP', { params : { username}});\n\n        // send mail with the OTP\n        if(status === 201){\n            let { data : { email }} = await getUser({ username });\n            let text = `Ваш код восстановления пароля: ${code}. Восстановите совой пароль.`;\n            await axios.post('/api/registerMail', { username, userEmail: email, text, subject : \"Код восстановления пароля\"});\n        }\n        return Promise.resolve(code);\n    } catch (error) {\n        console.error(\"ошибка создания кода\", error);\n        return Promise.reject({ error : error.message || \"Произошла ошибка при генерации OTP\" });\n    }\n}\n\n// verify OTP\nexport async function verifyOTP({ username, code }) {\n    try {\n        console.log(\"Sending request to verify OTP with:\", { username, code });\n        const { data, status } = await axios.get('/api/verifyOTP', { params: { username, code } });\n        return { data, status };\n    } catch (error) {\n        console.error(\"Error verifying OTP:\", error);\n        return Promise.reject(error);\n    }\n}\n\n// reset password\nexport async function resetPassword({ username, password }){\n    try {\n        const { data, status } = await axios.put('/api/resetPassword', { username, password });\n        return Promise.resolve({ data, status})\n    } catch (error) {\n        return Promise.reject({ error })\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}